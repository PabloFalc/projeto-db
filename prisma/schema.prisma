enum StatusDefault {
  PENDENTE
  CONCLUIDO
}

enum UserRole {
  ADMIN
  DEFAULT
}

enum Prioridade {
  ALTA
  MEDIA
  BAIXA
}

enum StatusEvento {
  CANCELADO
  AGENDADO
  ACONTECENDO
  CONCLUIDO
}

enum Zona {
  NORTE
  SUL
  LESTE
  OESTE
  CENTRO
  RURAL
  SUDESTE
}

enum AtendimentoTipo {
  PRESENCIAL
  WHATSAPP
  EMAIL
  TELEFONE
}

enum Despesa {
  FIXA
  AVULSA
}

generator client {
  provider      = "prisma-client-js"
  output        = "./prisma"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Colaborador {
  id             String    @id @default(uuid())
  nome           String    @db.VarChar(100)
  cpf            String?   @db.Char(14)
  email          String?   @db.VarChar(254)
  telefone       String?   @db.VarChar(15)
  dataNascimento DateTime?

  cep        String? @db.VarChar(9)
  zona       Zona?
  cidade     String? @db.VarChar(75)
  bairro     String? @db.VarChar(100)
  logradouro String? @db.VarChar(100)

  categoria  String? @db.VarChar(50)
  observacao String? @db.VarChar(150)
  curriculo  String? @db.VarChar(75)

  isLideranca   Boolean       @default(false)
  liderancaId   String?
  lideranca     Colaborador?  @relation("LiderancaColaboradores", fields: [liderancaId], references: [id], onDelete: SetNull)
  colaboradores Colaborador[] @relation("LiderancaColaboradores")

  criadosEm     DateTime @default(now())
  atualizadosEm DateTime @updatedAt

  eventos      Evento[]
  atendimentos Atendimento[] @relation("AtendimentosDoColaborador")
  projetos     Projeto[]     @relation("ProjetosRelacionados")

  @@map("Colaboradores")
}

model Demanda {
  id         String        @id @default(uuid())
  titulo     String        @db.VarChar(75)
  descricao  String        @db.VarChar(150)
  intervalo  Boolean       @default(false)
  dataInicio DateTime
  dataFim    DateTime?
  status     StatusDefault @default(PENDENTE)

  atendimentos Atendimento[] @relation("DemandaAtendimento")

  @@map("Demandas")
}

model Projeto {
  id        String   @id @default(uuid())
  titulo    String   @db.VarChar(75)
  descricao String   @db.VarChar(150)
  data      DateTime

  cep        String @db.VarChar(9)
  zona       Zona
  cidade     String @db.VarChar(75)
  bairro     String @db.VarChar(100)
  logradouro String @db.VarChar(100)

  colaboradorId String?
  colaborador   Colaborador? @relation("ProjetosRelacionados", fields: [colaboradorId], references: [id], onDelete: SetNull)

  atendimentos Atendimento[] @relation("ProjetoAtendimento")

  @@map("Projetos")
}

model Receita {
  id        String   @id @default(uuid())
  descricao String   @db.VarChar(150)
  valor     Int      @default(0)
  data      DateTime
  origem    String?  @db.VarChar(25)

  atendimento Atendimento? @relation("ReceitaAtendimento")

  @@map("Receitas")
}

model Evento {
  id            String        @id @default(uuid())
  nome          String        @db.VarChar(75)
  descricao     String        @db.VarChar(200)
  localizacao   String        @db.VarChar(50)
  categoria     String        @db.VarChar(20)
  status        StatusEvento  @default(AGENDADO)
  prioridade    Prioridade
  dataInicio    DateTime
  dataFim       DateTime
  participantes Colaborador[]

  @@map("Eventos")
}

model User {
  id       String   @id @default(uuid())
  userName String   @db.VarChar(30)
  name     String   @db.VarChar(100)
  email    String   @unique @db.VarChar(254)
  password String   @db.VarChar(254)
  role     UserRole @default(DEFAULT)

  atendimentos Atendimento[] @relation("AtendimentosPorUsuario")

  @@map("Usuarios")
}

model Atendimento {
  id        String          @id @default(uuid())
  descricao String
  tipo      AtendimentoTipo

  receitaId String?  @unique
  receita   Receita? @relation("ReceitaAtendimento", fields: [receitaId], references: [id])

  projeto Projeto[] @relation("ProjetoAtendimento")
  demanda Demanda[] @relation("DemandaAtendimento")

  // Relaçõe principais
  colaboradorId String?
  colaborador   Colaborador? @relation("AtendimentosDoColaborador", fields: [colaboradorId], references: [id])

  userId   String
  user     User     @relation("AtendimentosPorUsuario", fields: [userId], references: [id])
  criadoEm DateTime @default(now())

  @@map("Atendimentos")
}

model Logging {
  id         String   @id @default(uuid())
  userName   String   @db.VarChar(30)
  action     String   @db.VarChar(150)
  lastChange DateTime @default(now())
  updates    String[]
}
